include       mime.types;
sendfile      on;
default_type  application/octet-stream;

upstream qrgen {
    server 127.0.0.1:9001;
}

upstream corews {
    server 127.0.0.1:9002;
}

upstream web {
    server 127.0.0.1:9003;
}

server {
    listen 80;

    # QR generator at /qr/
    location /qr/ {
        proxy_pass http://qrgen/;
    }

    # Core backend WS/API at /ws/
    location /ws/ {
        proxy_pass http://corews/;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
    }

    # Web frontend for everything else
    location / {
        proxy_pass http://web/;
    }
}
